generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum NotificationChannel {
  email
  sms
  webhook
}

enum NotificationStatus {
  requested
  scheduled
  dispatched
  delivered
  failed
  cancelled
}

model Notification {
  id               String               @id @default(cuid())
  projectId        String
  tenantId         String?
  channel          NotificationChannel
  status           NotificationStatus   @default(requested)
  payload          Json
  lastErrorCode    String?
  lastErrorMessage String?
  lastErrorRetriable Boolean?
  provider         String?
  providerMessageId String?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
}

model OutboxEvent {
  id          String   @id @default(cuid())
  eventType   String
  payload     Json
  occurredAt  DateTime @default(now())
  processedAt DateTime?
}

model Template {
  id        String              @id @default(cuid())
  name      String
  channel   NotificationChannel
  content   Json
  variables Json
  active    Boolean             @default(true)
  version   Int                 @default(1)
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt

  @@unique([name, version])
  @@index([name])
  @@index([channel])
}
